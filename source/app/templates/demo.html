{% extends "base.html" %}

{% block body %}

  <table>
    <tr colspan="2">
      <td>
        <table>
          <tr>
            <td>
              <div class="attest"
                   data-name="dashboard_pull-request">
                <div>dashboard.pull-request</div>
                <div>[tick]</div>
              </div>
            </td>

            <td>
              <div class="attest"
                   data-name="dashboard_lint">
                <div>dashboard.lint</div>
                <div>[tick]</div>
              </div>
            </td>

            <td>
              <div class="attest"
                   data-name="dashboard">
                <div>dashboard</div>
                <div>[tick]</div>
              </div>
            </td>

            <td>
              <div class="attest"
                   data-name="dashboard_unit-test">
                <div>dashboard.unit-test</div>
                <div>[tick]</div>
              </div>
            </td>

            <td>
              <div class="attest"
                   data-name="dashboard_snyk">
                <div>dashboard.snyk</div>
                <div>[tick]</div>
              </div>
            </td>

          </tr>
        </table>
      </td>
    </tr>

    <tr>
      <td>
        <div class="filename">.kosli.yml</div>
        <div class="template-yml">
          <span class="line"                       >version: 1</span>
          <span class="line"                       ></span>
          <span class="line"                       >trail:</span>
          <span class="line"                       >  artifacts:</span>
          <span class="line dashboard"             >    --name: dashboard</span>
          <span class="line"                       >    attestations:</span>
          <span class="line dashboard_lint"        >      --name: lint</span>
          <span class="line dashboard_lint"        >        type: generic</span>
          <span class="line dashboard_pull-request">      --name: pull-request</span>
          <span class="line dashboard_pull-request">        type: pull_request</span>
          <span class="line dashboard_unit-test"   >      --name: unit-test</span>
          <span class="line dashboard_unit-test"   >        type: junit</span>
          <span class="line dashboard_snyk"        >      --name: snyk</span>
          <span class="line dashboard_snyk"        >        type: snyk</span>
          <span class="line"                       ></span>
        </div>
      </td>
      <td>
        commentary here...
      </td>
    </tr>

    <tr>
      <td>
        <div class="filename">Github Actions workflow</div>
        <div class="ci-yml">
          <span class="line"                       ></span>
          <span class="line"                       ></span>
          <span class="line"                       ></span>
          <span class="line dashboard_pull-request">line for PR</span>
          <span class="line"                       ></span>
          <span class="line"                       ></span>
          <span class="line"                       ></span>
          <span class="line"                       ></span>
          <span class="line dashboard_lint"        >line for lint</span>
          <span class="line"                       ></span>
          <span class="line"                       ></span>
          <span class="line"                       ></span>
          <span class="line"                       ></span>
          <span class="line"                       ></span>
          <span class="line dashboard"             >line for dashboard</span>
          <span class="line dashboard"             >line for dashboard</span>
          <span class="line"                       ></span>
          <span class="line"                       ></span>
          <span class="line"                       ></span>
          <span class="line"                       ></span>
          <span class="line"                       ></span>
          <span class="line dashboard_unit-test"   >line for UT 1</span>
          <span class="line dashboard_unit-test"   >line for UT 2</span>
          <span class="line dashboard_unit-test"   >line for UT 2</span>
          <span class="line"                       ></span>
          <span class="line"                       ></span>
          <span class="line"                       ></span>
          <span class="line"                       ></span>
          <span class="line dashboard_snyk"        >line for snyk</span>
          <span class="line"                       ></span>
          <span class="line"                       ></span>
          <span class="line"                       ></span>
          <span class="line"                       ></span>
        </div>
      </td>
      <td>
        commentary here...
      </td>
    </tr>
  </table>


{% endblock %}

{% block js %}
<script type="text/javascript">
  $(window).ready(()=> {

    const scrollIntoView = (nodes) => {
      nodes.last().scrollIntoView({duration:1000});
    };

    // When you click on an attestation
    const $attestations = $(".attest");

    $attestations.each(function() {
      const $attest = $(this);
      $attest.click(function() {
        const name = $attest.data("name");

        const highlight = (kind) => {
          const nodes = $(`.${kind} .${name}`);
          $(`.${kind} .line`).removeClass('lit');
          nodes.each(function() { $(this).addClass('lit'); });
          scrollIntoView(nodes);
        };
        // Highlight only that attestation
        $attestations.removeClass('lit');
        $attest.addClass('lit');
        // And the lines in the yml files for that attestation
        highlight('ci-yml');
        highlight('template-yml');
      });
    });

    // When you click in ci-yml
    const $ci_yml_lines = $(".ci-yml .line");
    $ci_yml_lines.click(function() {
      const $line = $(this);
      const classes = $line.attr('class').split(/\s+/);
      $.each(classes, function(index, name) {
        if (name != "line") {
          // Highlight attestation
          $('.attest').removeClass('lit');
          $(`.attest[data-name='${name}']`).addClass('lit');
          // Highlight template-yml
          $('.template-yml .line').removeClass('lit');
          const nodes = $(`.template-yml .${name}`);
          nodes.addClass('lit');
          scrollIntoView(nodes);
        }
      });
      // Highlight self
      $ci_yml_lines.removeClass('lit');
      $line.addClass('lit');
    });

    // When you click in template-yml
    const $template_yml_lines = $(".template-yml .line");
    $template_yml_lines.click(function() {
      const $line = $(this);
      const classes = $line.attr('class').split(/\s+/);
      $.each(classes, function(index, name) {
        if (name != "line") {
          // Highlight attestation
          $('.attest').removeClass('lit');
          $(`.attest[data-name='${name}']`).addClass('lit');
          // Highlight ci-yml
          $('.ci-yml .line').removeClass('lit');
          const nodes = $(`.ci-yml .${name}`);
          nodes.addClass('lit');
          scrollIntoView(nodes);
        }
      });
      // Highlight self
      $template_yml_lines.removeClass('lit');
      $line.addClass('lit');
    });

  });
</script>
{% endblock %}
